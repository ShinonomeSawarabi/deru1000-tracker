<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Åß„Çã1000 „Éà„É©„ÉÉ„Ç´„Éº</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:       #0c0c10;
  --surface:  #14141c;
  --surface2: #1c1c28;
  --border:   #272736;
  --accent:   #e8c547;
  --accent2:  #5bc8af;
  --danger:   #e05c5c;
  --text:     #e4e4f0;
  --muted:    #b8b8e8;
  --nav-w:    220px;
  --nav-w-sm: 52px;
  --radius:   7px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Noto Sans JP', sans-serif;
  font-size: 14px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* ===================== TOP BAR ===================== */
.topbar {
  height: 48px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 20px 0 0;
  gap: 16px;
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 300;
}
.topbar-logo {
  width: var(--nav-w);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 0 16px;
  transition: width 0.25s ease;
  overflow: hidden;
  white-space: nowrap;
  border-right: 1px solid var(--border);
  height: 100%;
}
.topbar-logo.collapsed { width: var(--nav-w-sm); }
.topbar-logo-icon {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 22px;
  color: var(--accent);
  letter-spacing: 2px;
  flex-shrink: 0;
}
.topbar-logo-text {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 1px;
  opacity: 1;
  transition: opacity 0.15s;
}
.topbar-logo.collapsed .topbar-logo-text { opacity: 0; pointer-events: none; }

.topbar-stats {
  display: flex;
  gap: 20px;
  align-items: center;
  flex: 1;
}
.ts { text-align: center; }
.ts-val {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 18px;
  color: var(--accent);
  line-height: 1;
}
.ts-lbl {
  font-size: 8px;
  color: var(--muted);
  font-family: 'Space Mono', monospace;
  letter-spacing: 0.5px;
}
.topbar-cool-badge {
  margin-left: auto;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 16px;
  color: var(--accent);
  letter-spacing: 2px;
  background: var(--surface2);
  border: 1px solid var(--border);
  padding: 4px 12px;
  border-radius: 4px;
}

/* ===================== LAYOUT ===================== */
.layout {
  display: flex;
  flex: 1;
  margin-top: 48px;
}

/* ===================== SIDENAV ===================== */
.sidenav {
  width: var(--nav-w);
  flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  position: fixed;
  top: 48px;
  left: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  transition: width 0.25s ease;
  overflow: hidden;
  z-index: 200;
}
.sidenav.collapsed { width: var(--nav-w-sm); }



/* „Çª„ÇØ„Ç∑„Éß„É≥„É©„Éô„É´ */
.nav-section-label {
  padding: 12px 16px 6px;
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--muted);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  white-space: nowrap;
  overflow: hidden;
  opacity: 1;
  transition: opacity 0.15s;
}
.sidenav.collapsed .nav-section-label { opacity: 0; }

/* „Éä„Éì„Ç¢„Ç§„ÉÜ„É†Ôºà„ÇØ„Éº„É´Ôºâ */
.nav-items { flex: 1; overflow-y: auto; overflow-x: hidden; }
.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  cursor: pointer;
  transition: background 0.12s;
  white-space: nowrap;
  overflow: hidden;
  position: relative;
  border-left: 3px solid transparent;
}
.nav-item:hover { background: var(--surface2); }
.nav-item.active {
  background: #141420;
  border-left-color: var(--accent);
}
.nav-item-icon {
  width: 24px;
  height: 24px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 13px;
  letter-spacing: 0.5px;
  flex-shrink: 0;
  background: var(--surface2);
  color: var(--muted);
  border: 1px solid var(--border);
  transition: all 0.12s;
}
.nav-item.active .nav-item-icon {
  background: var(--accent);
  color: #000;
  border-color: var(--accent);
}
.nav-item-body { flex: 1; overflow: hidden; opacity: 1; transition: opacity 0.15s; }
.sidenav.collapsed .nav-item-body { opacity: 0; pointer-events: none; }
.nav-item-name {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
  color: var(--text);
}
.nav-item.active .nav-item-name { color: var(--accent); }
.nav-item-meta {
  font-family: 'Space Mono', monospace;
  font-size: 9px;
  color: var(--muted);
  margin-top: 1px;
}
.nav-item-del {
  background: none; border: none; color: transparent;
  font-size: 10px; cursor: pointer; padding: 2px 4px;
  border-radius: 3px; transition: all 0.12s; flex-shrink: 0;
}
.nav-item:hover .nav-item-del { color: var(--muted); }
.nav-item-del:hover { color: var(--danger) !important; background: #2a1010; }
.sidenav.collapsed .nav-item-del { display: none; }

/* ËøΩÂä†„Éú„Çø„É≥ */
.nav-add {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 14px;
  cursor: pointer;
  border-top: 1px solid var(--border);
  color: var(--muted);
  transition: background 0.12s, color 0.12s;
  white-space: nowrap;
  overflow: hidden;
  flex-shrink: 0;
}
.nav-add:hover { background: var(--surface2); color: var(--accent2); }
.nav-add-icon {
  width: 24px; height: 24px;
  border-radius: 5px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px; flex-shrink: 0;
  border: 1px dashed var(--border);
  transition: border-color 0.12s;
}
.nav-add:hover .nav-add-icon { border-color: var(--accent2); }
.nav-add-text {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  letter-spacing: 0.5px;
  opacity: 1; transition: opacity 0.15s;
}
.sidenav.collapsed .nav-add-text { opacity: 0; pointer-events: none; }

/* ===================== MAIN CONTENT ===================== */
.main-content {
  flex: 1;
  margin-left: var(--nav-w);
  transition: margin-left 0.25s ease;
  padding: 20px 20px 76px; /* ‰∏ã„Å´„Éú„Éà„É†„Éä„ÉìÂàÜ„ÅÆ‰ΩôÁôΩ */
  min-width: 0;
}
.main-content.nav-collapsed { margin-left: var(--nav-w-sm); }

/* ===================== SECTION ACCORDION ===================== */
.acc-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 16px;
}
.acc-card-header {
  background: var(--surface2);
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  font-family: 'Space Mono', monospace;
  font-size: 10px; color: var(--muted);
  letter-spacing: 1px; text-transform: uppercase;
  display: flex; justify-content: space-between; align-items: center;
}
.ca { color: var(--accent); }
.acc-list {}

.acc-trigger {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.12s;
  user-select: none;
}
.acc-trigger:hover { background: var(--surface2); }
.acc-trigger.open {
  background: #111118;
  border-left: 3px solid var(--accent);
  padding-left: 13px;
}
.dot { width:7px; height:7px; border-radius:50%; background:var(--border); flex-shrink:0; }
.dot.done { background: var(--accent2); }
.sl { font-family:'Space Mono',monospace; font-size:10px; color:var(--text); min-width:28px; }
.sr { font-size:12px; font-weight:500; flex:1; }
.ss { font-family:'Space Mono',monospace; font-size:10px; color:var(--muted); }
.chevron { font-size:9px; color:var(--muted); transition:transform 0.18s; flex-shrink:0; }
.acc-trigger.open .chevron { transform:rotate(180deg); color:var(--accent); }

/* „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥Êú¨‰Ωì */
.acc-body {
  border-bottom: 2px solid var(--accent);
  background: #0b0b10;
  animation: sd 0.16s ease-out;
}
@keyframes sd {
  from { opacity:0; transform:translateY(-4px); }
  to   { opacity:1; transform:translateY(0); }
}
.inline-form {
  padding: 12px 16px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  gap: 8px;
}
.ff { display:flex; flex-direction:column; gap:3px; }
.ff label { font-size:9px; color:var(--muted); font-family:'Space Mono',monospace; letter-spacing:0.5px; text-transform:uppercase; }
.ff input {
  background: var(--surface2); border: 1px solid var(--border);
  border-radius: 3px; padding: 7px 8px; color: var(--text);
  font-family: 'Space Mono', monospace; font-size:12px; width:100%;
  transition: border-color 0.12s;
}
.ff input:focus { outline:none; border-color:var(--accent); }
.form-footer {
  padding: 0 16px 12px;
  display: flex; gap: 8px;
}
.btn-save {
  flex:1; background:var(--accent); color:#000; border:none;
  border-radius:3px; padding:8px;
  font-family:'Bebas Neue',sans-serif; font-size:14px; letter-spacing:1px;
  cursor:pointer; transition:opacity 0.12s;
}
.btn-save:hover { opacity:0.82; }
.btn-clear {
  background:none; border:1px solid var(--border); color:var(--muted);
  border-radius:3px; padding:8px 14px;
  font-family:'Space Mono',monospace; font-size:11px; cursor:pointer; transition:all 0.12s;
}
.btn-clear:hover { border-color:var(--danger); color:var(--danger); }

/* Ë®òÈå≤1‰ª∂Ë°®Á§∫ */
.record-display {
  margin: 0 16px 12px;
  border: 1px solid var(--border);
  border-radius: 4px;
  overflow: hidden;
}
.rd-header {
  background: var(--surface2); padding:5px 10px;
  font-family:'Space Mono',monospace; font-size:9px; color:var(--muted);
  letter-spacing:1px; text-transform:uppercase;
  display:flex; justify-content:space-between;
}
.rd-header .recorded { color:var(--accent2); }
.rd-body { display:grid; grid-template-columns:1fr 1fr 1fr 1fr; }
.rd-cell {
  padding:9px 10px; text-align:center;
  border-right:1px solid var(--border);
}
.rd-cell:last-child { border-right:none; }
.rd-val { font-family:'Bebas Neue',sans-serif; font-size:20px; line-height:1; }
.rd-key { font-family:'Space Mono',monospace; font-size:8px; color:var(--muted); margin-top:2px; }
.rd-date { color:var(--muted); font-size:13px !important; }
.rd-err  { color:var(--danger); }
.rd-tim  { color:var(--accent2); }
.rd-rem  { color:var(--accent); }
.no-record {
  padding:12px; text-align:center;
  font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
}

/* ===================== RIGHT PANELS ===================== */
.right-panels {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 16px;
}
.panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}
.panel-header {
  background: var(--surface2); padding:10px 16px;
  border-bottom:1px solid var(--border);
  font-family:'Space Mono',monospace; font-size:10px; color:var(--muted);
  letter-spacing:1px; text-transform:uppercase;
  display:flex; justify-content:space-between; align-items:center;
}

/* Ë™§Á≠î„ÉÅ„É£„Éº„Éà */
.chart-area { padding:14px 16px; }
.chart-row { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.chart-row:last-child { margin-bottom:0; }
.csl { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); min-width:22px; text-align:right; }
.cbw { flex:1; height:12px; background:var(--surface2); border-radius:2px; overflow:hidden; cursor:pointer; transition:background 0.12s; }
.cbw:hover { background:var(--border); }
.cb  { height:100%; border-radius:2px; background:linear-gradient(90deg,var(--danger),#f07878); transition:width 0.35s; }
.cv  { font-family:'Space Mono',monospace; font-size:9px; color:var(--muted); min-width:20px; }

/* ===== BOTTOM NAV ===== */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 56px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  display: flex;
  z-index: 300;
}
.bnav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  cursor: pointer;
  transition: background 0.12s;
  border: none;
  background: none;
  color: var(--muted);
  position: relative;
}
.bnav-item:hover { background: var(--surface2); }
.bnav-item.active { color: var(--accent); }
.bnav-item.active::after {
  content: '';
  position: absolute;
  top: 0; left: 20%; right: 20%;
  height: 2px;
  background: var(--accent);
  border-radius: 0 0 2px 2px;
}
.bnav-icon { font-size: 18px; line-height: 1; }
.bnav-label {
  font-family: 'Space Mono', monospace;
  font-size: 8px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

/* ===== PAGE VIEWS ===== */
.page { display: none; }
.page.active { display: block; }

/* ===== ANALYSIS ===== */

.analysis-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 16px;
}
.analysis-card-header {
  background: var(--surface2);
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
  font-family: 'Space Mono', monospace;
  font-size: 10px; color: var(--muted);
  letter-spacing: 1px; text-transform: uppercase;
  display: flex; justify-content: space-between; align-items: center;
}

/* „Éû„Éà„É™„ÇØ„ÇπË°® */
.matrix-scroll { overflow-x: auto; }
.matrix-table {
  width: 100%;
  border-collapse: collapse;
  min-width: 300px;
}
.matrix-table th {
  padding: 8px 6px;
  font-family: 'Space Mono', monospace;
  font-size: 9px; color: var(--muted);
  letter-spacing: 1px; text-transform: uppercase;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  text-align: center;
  white-space: nowrap;
}
.matrix-table th.sec-th { text-align: left; width: 42px; }
.matrix-table td {
  padding: 0;
  border-bottom: 1px solid var(--border);
  border-right: 1px solid var(--border);
  vertical-align: middle;
}
.matrix-table td.sec-td {
  padding: 6px 8px;
  font-family: 'Space Mono', monospace;
  font-size: 10px; color: var(--text);
  width: 42px;
  background: var(--surface2);
}
.matrix-table tr:last-child td { border-bottom: none; }
.matrix-table td:last-child { border-right: none; }

.cell-pair {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 5px 6px;
  gap: 2px;
  min-width: 40px;
}
.cell-err {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 16px;
  color: var(--danger);
  line-height: 1;
}
.cell-rem {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 13px;
  color: var(--accent);
  line-height: 1;
}
.cell-empty {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  color: var(--border);
  padding: 10px;
  text-align: center;
}

/* „Éà„É¨„É≥„ÉâÁü¢Âç∞ */
.trend-up   { color: var(--accent2); font-size: 10px; }
.trend-down { color: var(--danger);  font-size: 10px; }
.trend-flat { color: var(--muted);   font-size: 10px; }

/* Âá°‰æã */
.legend {
  display: flex; gap: 16px; padding: 10px 16px;
  font-family: 'Space Mono', monospace; font-size: 9px;
  border-top: 1px solid var(--border);
}
.legend-item { display: flex; align-items: center; gap: 6px; color: var(--muted); }
.legend-dot-err { width:8px; height:8px; border-radius:2px; background:var(--danger); flex-shrink:0; }
.legend-dot-rem { width:8px; height:8px; border-radius:2px; background:var(--accent); flex-shrink:0; }

/* ===== CUSTOM DIALOG ===== */
.dialog-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 999;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.dialog-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  max-width: 340px;
  width: 100%;
  box-shadow: 0 8px 40px rgba(0,0,0,0.6);
}
.dialog-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 20px;
  color: var(--accent);
  letter-spacing: 1px;
  margin-bottom: 10px;
}
.dialog-msg {
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  color: var(--text);
  line-height: 1.7;
  margin-bottom: 8px;
}
.dialog-warn {
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  color: var(--danger);
  line-height: 1.6;
  margin-bottom: 20px;
  padding: 8px 10px;
  background: #1a0a0a;
  border: 1px solid #3a1a1a;
  border-radius: 4px;
}
.dialog-btns {
  display: flex;
  gap: 8px;
}
.dialog-btn-cancel {
  flex: 1;
  background: none;
  border: 1px solid var(--border);
  color: var(--muted);
  border-radius: 4px;
  padding: 9px;
  font-family: 'Space Mono', monospace;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.12s;
}
.dialog-btn-cancel:hover { border-color: var(--text); color: var(--text); }
.dialog-btn-del {
  flex: 1;
  background: var(--danger);
  border: none;
  color: #fff;
  border-radius: 4px;
  padding: 9px;
  font-family: 'Bebas Neue', sans-serif;
  font-size: 15px;
  letter-spacing: 1px;
  cursor: pointer;
  transition: opacity 0.12s;
}
.dialog-btn-del:hover { opacity: 0.85; }
::-webkit-scrollbar { width:4px; height:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

@media (max-width: 900px) {
  .right-panels { grid-template-columns: 1fr; }
}
@media (max-width: 600px) {
  .sidenav { width: var(--nav-w-sm); }
  .sidenav .nav-item-body,
  .sidenav .nav-add-text,
  .sidenav .nav-section-label,
  .sidenav .topbar-logo-text { opacity:0; pointer-events:none; }
  .main-content { margin-left: var(--nav-w-sm); }
  .inline-form { grid-template-columns:1fr 1fr; }
}
</style>
</head>
<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-logo" id="topbar-logo">
    <span class="topbar-logo-icon">D1K</span>
    <span class="topbar-logo-text">„Åß„Çã1000 TRACKER</span>
  </div>
  <div class="topbar-stats">
    <div class="ts"><div class="ts-val" id="ts-done">0</div><div class="ts-lbl">DONE / 15</div></div>
    <div class="ts"><div class="ts-val" id="ts-avg">‚Äî</div><div class="ts-lbl">AVG ERR</div></div>
    <div class="ts"><div class="ts-val" id="ts-rem">‚Äî</div><div class="ts-lbl">AVG REM</div></div>
  </div>
  <div class="topbar-cool-badge" id="tb-cool-badge">COOL 1</div>
</div>

<div class="layout">

  <!-- SIDENAV -->
  <nav class="sidenav" id="sidenav">

    <div class="nav-section-label">COOLS</div>

    <div class="nav-items" id="nav-items"></div>



  </nav>

  <!-- MAIN -->
  <div class="main-content" id="main-content">

    <!-- PAGE: SECTIONS -->
    <div class="page active" id="page-sections">

      <div class="acc-card">
        <div class="acc-card-header">
          <span>SECTIONS ‚Äî <span class="ca" id="acc-cool-lbl"></span></span>
          <span id="acc-done-lbl" style="color:var(--accent2)"></span>
        </div>
        <div class="acc-list" id="acc-list"></div>
      </div>



    </div>

    <!-- PAGE: ANALYSIS -->
    <div class="page" id="page-analysis">

      <div class="analysis-card">
        <div class="analysis-card-header">
          <span>„ÇØ„Éº„É´Âà•Êé®Áßª ‚Äî ÂÖ®„Çª„ÇØ„Ç∑„Éß„É≥</span>
          <span style="color:var(--muted)">‰∏äÊÆµ: Ë™§Á≠îÊï∞„ÄÄ‰∏ãÊÆµ: ÊúÄÁµÇÊÆãË™§Á≠î</span>
        </div>
        <div class="matrix-scroll">
          <table class="matrix-table" id="matrix-table"></table>
        </div>
        <div class="legend">
          <div class="legend-item"><div class="legend-dot-err"></div>Ë™§Á≠îÊï∞</div>
          <div class="legend-item"><div class="legend-dot-rem"></div>ÊúÄÁµÇÊÆãË™§Á≠îÊï∞</div>
        </div>
      </div>

    </div>

    <!-- PAGE: SETTINGS -->
    <div class="page" id="page-settings">

      <div class="analysis-card">
        <div class="analysis-card-header">
          <span>COOL ÁÆ°ÁêÜ</span>
        </div>
        <div id="settings-cool-list" style="padding:8px;"></div>
        <div style="padding:8px 12px 12px;">
          <button class="btn-save" style="width:100%;font-size:13px;padding:10px;" onclick="addCool()">Ôºã Êñ∞„Åó„ÅÑ„ÇØ„Éº„É´„ÇíËøΩÂä†</button>
        </div>
      </div>

      <div class="analysis-card" style="margin-top:16px;">
        <div class="analysis-card-header">
          <span>„Åù„ÅÆ‰ªñ„ÅÆË®≠ÂÆö</span>
        </div>
        <div style="padding:32px;text-align:center;font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);">
          ‰ªäÂæåËøΩÂä†‰∫àÂÆö
        </div>
      </div>

    </div>

  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bnav-item active" id="bnav-sections" onclick="switchPage('sections')">
    <span class="bnav-icon">üìã</span>
    <span class="bnav-label">Sections</span>
  </button>
  <button class="bnav-item" id="bnav-analysis" onclick="switchPage('analysis')">
    <span class="bnav-icon">üìä</span>
    <span class="bnav-label">Analysis</span>
  </button>
  <button class="bnav-item" id="bnav-settings" onclick="switchPage('settings')">
    <span class="bnav-icon">‚öôÔ∏è</span>
    <span class="bnav-label">Settings</span>
  </button>
</nav>

<script>
// ============================================================
// „Çª„ÇØ„Ç∑„Éß„É≥ÂÆöÁæ©
// ============================================================
const SECTIONS = [
  {id:1,  range:'3„Äú45',    q:43},
  {id:2,  range:'46„Äú88',   q:43},
  {id:3,  range:'89„Äú131',  q:43},
  {id:4,  range:'132„Äú174', q:43},
  {id:5,  range:'175„Äú217', q:43},
  {id:6,  range:'218„Äú260', q:43},
  {id:7,  range:'261„Äú303', q:43},
  {id:8,  range:'304„Äú349', q:46},
  {id:9,  range:'350„Äú392', q:43},
  {id:10, range:'393„Äú435', q:43},
  {id:11, range:'436„Äú480', q:45},
  {id:12, range:'481„Äú524', q:44},
  {id:13, range:'525„Äú569', q:45},
  {id:14, range:'570„Äú612', q:43},
  {id:15, range:'613„Äú659', q:47},
];

// ============================================================
// DB
// ============================================================
const SK = 'deru1000_v4';
function loadDB(){
  try {
    const r = JSON.parse(localStorage.getItem(SK)||'null');
    if(!r) return {cools:[1], currentCool:1, records:{}, navCollapsed:false};
    if(r.navCollapsed===undefined) r.navCollapsed=false;
    return r;
  } catch(e){ return {cools:[1], currentCool:1, records:{}, navCollapsed:false}; }
}
function saveDB(){ localStorage.setItem(SK, JSON.stringify(db)); }

let db = loadDB();
let openSec = null;

function rk(cool,sid){ return `c${cool}_s${sid}`; }
function getRec(cool,sid){ return db.records[rk(cool,sid)]||null; }

// ============================================================
// „ÇØ„Éº„É´Êìç‰Ωú
// ============================================================
function addCool(){
  const n = db.cools.length>0 ? Math.max(...db.cools)+1 : 1;
  db.cools.push(n);
  db.currentCool = n;
  openSec = null;
  saveDB(); renderAll();
}
function delCool(cool,e){
  e.stopPropagation();
  if(db.cools.length===1){alert('ÊúÄ‰Ωé1„ÇØ„Éº„É´„ÅØÂøÖË¶Å„Åß„Åô');return;}
  if(!confirm(`COOL ${cool} „ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`))return;
  db.cools = db.cools.filter(c=>c!==cool);
  Object.keys(db.records).forEach(k=>{ if(k.startsWith(`c${cool}_`)) delete db.records[k]; });
  if(db.currentCool===cool) db.currentCool = db.cools[0];
  openSec = null;
  saveDB(); renderAll();
}
function switchCool(cool){
  db.currentCool = cool;
  openSec = null;
  saveDB(); renderAll();
}

// ============================================================
// „É¨„Ç≥„Éº„ÉâÊìç‰Ωú
// ============================================================
function saveRecord(sid){
  const date = document.getElementById(`id-${sid}`).value;
  const err  = document.getElementById(`ie-${sid}`).value;
  const tim  = document.getElementById(`it-${sid}`).value;
  const rem  = document.getElementById(`ir-${sid}`).value;
  if(!date){alert('ÂÆüÊñΩÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');return;}
  db.records[rk(db.currentCool,sid)] = {date, errors:err, time:tim, remaining:rem};
  saveDB();
  openSec = sid;
  renderAll();
}
function clearRecord(sid){
  showDialog(
    'Ë®òÈå≤„ÇíÂâäÈô§',
    `S${String(sid).padStart(2,'0')} „ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ`,
    'ÂâäÈô§„Åô„Çã„Å®ÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ',
    ()=>{
      delete db.records[rk(db.currentCool,sid)];
      saveDB(); openSec = sid; renderAll();
    }
  );
}

// „Ç´„Çπ„Çø„É†Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
function showDialog(title, msg, warn, onOk){
  const overlay = document.createElement('div');
  overlay.className = 'dialog-overlay';
  overlay.innerHTML = `
    <div class="dialog-box">
      <div class="dialog-title">${title}</div>
      <div class="dialog-msg">${msg}</div>
      ${warn ? `<div class="dialog-warn">‚ö†Ô∏è ${warn}</div>` : ''}
      <div class="dialog-btns">
        <button class="dialog-btn-cancel" id="dlg-cancel">„Ç≠„É£„É≥„Çª„É´</button>
        <button class="dialog-btn-del" id="dlg-ok">ÂâäÈô§„Åô„Çã</button>
      </div>
    </div>`;
  document.body.appendChild(overlay);
  document.getElementById('dlg-cancel').addEventListener('click', ()=> overlay.remove());
  document.getElementById('dlg-ok').addEventListener('click', ()=>{ overlay.remove(); onOk(); });
}

function delCoolFromSettings(cool){
  if(db.cools.length===1){ alert('ÊúÄ‰Ωé1„ÇØ„Éº„É´„ÅØÂøÖË¶Å„Åß„Åô'); return; }
  const recs = SECTIONS.filter(sec => getRec(cool, sec.id)).length;
  showDialog(
    `COOL ${cool} „ÇíÂâäÈô§`,
    `„Åì„ÅÆ„ÇØ„Éº„É´„ÅÆË®òÈå≤„Çí„Åô„Åπ„Å¶ÂâäÈô§„Åó„Åæ„Åô„ÄÇ`,
    recs > 0 ? `${recs} „Çª„ÇØ„Ç∑„Éß„É≥ÂàÜ„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÂâäÈô§„Åô„Çã„Å®ÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ` : null,
    ()=>{
      db.cools = db.cools.filter(c=>c!==cool);
      Object.keys(db.records).forEach(k=>{ if(k.startsWith(`c${cool}_`)) delete db.records[k]; });
      if(db.currentCool===cool) db.currentCool = db.cools[0];
      openSec = null;
      saveDB(); renderAll();
    }
  );
}

// ============================================================
// SettingsÊèèÁîª
// ============================================================
function renderSettings(){
  const list = document.getElementById('settings-cool-list');
  if(!list) return;
  list.innerHTML = '';
  db.cools.forEach(cool=>{
    let done=0, errs=0, ec=0;
    SECTIONS.forEach(sec=>{
      const r=getRec(cool,sec.id);
      if(r){ done++; if(r.errors!==''&&r.errors!=null){errs+=Number(r.errors);ec++;} }
    });
    const avg = ec>0?(errs/ec).toFixed(1):'‚Äî';
    const isActive = db.currentCool===cool;

    const row = document.createElement('div');
    row.style.cssText = 'display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:5px;margin-bottom:6px;background:'+(isActive?'#141420':'var(--surface2)')+';border:1px solid '+(isActive?'var(--accent)':'var(--border)')+';cursor:pointer;';
    // Ë°å„ÇØ„É™„ÉÉ„ÇØ„Åß„ÇØ„Éº„É´Âàá„ÇäÊõø„Åà
    row.addEventListener('click', ()=>{ switchCool(cool); });

    // „Ç¢„Ç§„Ç≥„É≥
    const icon = document.createElement('div');
    icon.style.cssText = 'width:30px;height:30px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-family:"Bebas Neue",sans-serif;font-size:15px;flex-shrink:0;background:'+(isActive?'var(--accent)':'var(--surface)')+';color:'+(isActive?'#000':'var(--muted)')+';border:1px solid '+(isActive?'var(--accent)':'var(--border)')+';pointer-events:none;';
    icon.textContent = cool;

    // „ÉÜ„Ç≠„Çπ„Éà
    const body = document.createElement('div');
    body.style.cssText = 'flex:1;pointer-events:none;';
    const name = document.createElement('div');
    name.style.cssText = 'font-family:"Space Mono",monospace;font-size:11px;font-weight:700;color:'+(isActive?'var(--accent)':'var(--text)')+';';
    name.textContent = 'COOL '+cool+(isActive?' ‚óè ÈÅ∏Êäû‰∏≠':'');
    const meta = document.createElement('div');
    meta.style.cssText = 'font-family:"Space Mono",monospace;font-size:9px;color:var(--muted);margin-top:2px;';
    meta.textContent = done+'/15 ÂÆå‰∫Ü ¬∑ Âπ≥ÂùáË™§Á≠î '+avg;
    body.appendChild(name);
    body.appendChild(meta);

    row.appendChild(icon);
    row.appendChild(body);

    // ÂâäÈô§„Éú„Çø„É≥
    if(db.cools.length>1){
      const btn = document.createElement('button');
      btn.style.cssText = 'background:none;border:1px solid var(--border);color:var(--muted);border-radius:3px;padding:5px 12px;font-family:"Space Mono",monospace;font-size:10px;cursor:pointer;flex-shrink:0;';
      btn.textContent = 'ÂâäÈô§';
      btn.addEventListener('mouseenter', ()=>{ btn.style.borderColor='var(--danger)'; btn.style.color='var(--danger)'; });
      btn.addEventListener('mouseleave', ()=>{ btn.style.borderColor='var(--border)'; btn.style.color='var(--muted)'; });
      btn.addEventListener('click', (e)=>{
        e.stopPropagation(); // Ë°å„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíÊ≠¢„ÇÅ„Çã
        delCoolFromSettings(cool);
      });
      row.appendChild(btn);
    }

    list.appendChild(row);
  });
}

// ============================================================
// „Éö„Éº„Ç∏Âàá„ÇäÊõø„ÅàÔºà„Éú„Éà„É†„Éä„ÉìÔºâ
// ============================================================
let currentPage = 'sections';
function switchPage(page){
  currentPage = page;
  ['sections','analysis','settings'].forEach(p=>{
    document.getElementById(`page-${p}`).classList.toggle('active', p===page);
    document.getElementById(`bnav-${p}`).classList.toggle('active', p===page);
  });
  if(page==='analysis') renderMatrix();
  if(page==='settings') renderSettings();
}

// ============================================================
// ÂàÜÊûê„Éû„Éà„É™„ÇØ„Çπ
// ============================================================
function renderMatrix(){
  const table = document.getElementById('matrix-table');
  const cools = db.cools;

  // „Éò„ÉÉ„ÉÄ„ÉºË°å
  let thead = '<thead><tr><th class="sec-th">SEC</th>';
  cools.forEach(c => { thead += `<th>C${c}</th>`; });
  if(cools.length > 1) thead += '<th>TREND</th>';
  thead += '</tr></thead>';

  // „Éú„Éá„Ç£
  let tbody = '<tbody>';
  SECTIONS.forEach(sec => {
    tbody += `<tr><td class="sec-td">S${String(sec.id).padStart(2,'0')}</td>`;

    const vals = cools.map(c => getRec(c, sec.id));

    vals.forEach(rec => {
      if(!rec){
        tbody += `<td><div class="cell-empty">‚Äî</div></td>`;
      } else {
        const e = (rec.errors!==''&&rec.errors!=null) ? rec.errors : '‚Äî';
        const r = (rec.remaining!==''&&rec.remaining!=null) ? rec.remaining : '‚Äî';
        tbody += `<td><div class="cell-pair"><span class="cell-err">${e}</span><span class="cell-rem">${r}</span></div></td>`;
      }
    });

    // „Éà„É¨„É≥„ÉâÂàóÔºà2„ÇØ„Éº„É´‰ª•‰∏ä„ÅÇ„Çã„Å®„ÅçÔºâ
    if(cools.length > 1){
      const first = vals.find(v=>v&&v.errors!==''&&v.errors!=null);
      const last  = [...vals].reverse().find(v=>v&&v.errors!==''&&v.errors!=null);
      let trend = `<span class="trend-flat">‚Äî</span>`;
      if(first && last && first !== last){
        const fe = Number(first.errors), le = Number(last.errors);
        if(le < fe)       trend = `<span class="trend-up">‚ñº ${fe-le}</span>`;
        else if(le > fe)  trend = `<span class="trend-down">‚ñ≤ ${le-fe}</span>`;
        else              trend = `<span class="trend-flat">= 0</span>`;
      }
      tbody += `<td style="text-align:center;padding:8px">${trend}</td>`;
    }

    tbody += '</tr>';
  });

  // ÂêàË®àË°å
  tbody += `<tr style="background:var(--surface2)"><td class="sec-td" style="color:var(--accent);font-weight:700">TOTAL AVG</td>`;
  cools.forEach(c => {
    let errs=0, ec=0, rems=0, rc=0;
    SECTIONS.forEach(sec=>{
      const r=getRec(c,sec.id);
      if(r){
        if(r.errors!==''&&r.errors!=null){errs+=Number(r.errors);ec++;}
        if(r.remaining!==''&&r.remaining!=null){rems+=Number(r.remaining);rc++;}
      }
    });
    const ae = ec>0?(errs/ec).toFixed(1):'‚Äî';
    const ar = rc>0?(rems/rc).toFixed(1):'‚Äî';
    tbody += `<td><div class="cell-pair"><span class="cell-err" style="font-size:13px">${ae}</span><span class="cell-rem" style="font-size:11px">${ar}</span></div></td>`;
  });
  if(cools.length>1) tbody += '<td></td>';
  tbody += '</tr></tbody>';

  table.innerHTML = thead + tbody;
}

// ============================================================
// „Çµ„Ç§„Éâ„Éä„ÉìÊèèÁîª
// ============================================================
function renderNav(){
  const items = document.getElementById('nav-items');
  items.innerHTML = '';
  db.cools.forEach(cool=>{
    let done=0, errs=0, ec=0;
    SECTIONS.forEach(sec=>{
      const r=getRec(cool,sec.id);
      if(r){ done++; if(r.errors!==''&&r.errors!=null){errs+=Number(r.errors);ec++;} }
    });
    const avg = ec>0 ? (errs/ec).toFixed(1) : '‚Äî';

    const item = document.createElement('div');
    item.className = 'nav-item'+(db.currentCool===cool?' active':'');
    item.onclick = ()=>switchCool(cool);
    item.innerHTML = `
      <div class="nav-item-icon">${cool}</div>
      <div class="nav-item-body">
        <div class="nav-item-name">COOL ${cool}</div>
        <div class="nav-item-meta">${done}/15 ÂÆå‰∫Ü ¬∑ Âπ≥Âùá ${avg}</div>
      </div>
      ${db.cools.length>1 ? `<button class="nav-item-del" onclick="delCool(${cool},event)" title="ÂâäÈô§">‚úï</button>` : ''}
    `;
    items.appendChild(item);
  });
}

// ============================================================
// „Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥
// ============================================================
function toggleSec(sid){
  openSec = (openSec===sid) ? null : sid;
  renderAcc();
}

function renderAcc(){
  const cool = db.currentCool;
  document.getElementById('acc-cool-lbl').textContent = `COOL ${cool}`;
  document.getElementById('tb-cool-badge').textContent = `COOL ${cool}`;
  const list = document.getElementById('acc-list');
  list.innerHTML = '';
  let done = 0;

  SECTIONS.forEach(sec=>{
    const rec = getRec(cool, sec.id);
    if(rec) done++;
    const isOpen = openSec === sec.id;

    const trigger = document.createElement('div');
    trigger.className = 'acc-trigger'+(isOpen?' open':'');
    trigger.onclick = ()=>toggleSec(sec.id);
    trigger.innerHTML = `
      <div class="dot ${rec?'done':''}"></div>
      <span class="sl">S${String(sec.id).padStart(2,'0')}</span>
      <span class="sr">${sec.range}</span>
      <span class="ss">${rec ? rec.date : '‚Äî'}</span>
      <span class="chevron">‚ñº</span>
    `;

    const row = document.createElement('div');
    row.appendChild(trigger);

    if(isOpen){
      const today = new Date().toLocaleDateString('sv-SE');
      const d = rec?.date || today;
      const e = rec?.errors ?? '';
      const t = rec?.time || '';
      const r = rec?.remaining ?? '';

      const body = document.createElement('div');
      body.className = 'acc-body';
      body.innerHTML = `
        <div class="inline-form">
          <div class="ff"><label>ÂÆüÊñΩÊó•</label><input type="date" id="id-${sec.id}" value="${d}"></div>
          <div class="ff"><label>Ë™§Á≠îÊï∞</label><input type="number" id="ie-${sec.id}" min="0" placeholder="0" value="${e}"></div>
          <div class="ff"><label>ÊâÄË¶ÅÊôÇÈñì</label><input type="text" id="it-${sec.id}" placeholder="12:30" value="${t}"></div>
          <div class="ff"><label>ÊúÄÁµÇÊÆãË™§Á≠î</label><input type="number" id="ir-${sec.id}" min="0" placeholder="0" value="${r}"></div>
        </div>
        <div class="form-footer">
          <button class="btn-save" onclick="saveRecord(${sec.id})">SAVE</button>
          ${rec ? `<button class="btn-clear" onclick="clearRecord(${sec.id})">ÂâäÈô§</button>` : ''}
        </div>
        ${rec ? `
        <div class="record-display">
          <div class="rd-header">
            <span>ÁèæÂú®„ÅÆË®òÈå≤</span><span class="recorded">‚óè SAVED</span>
          </div>
          <div class="rd-body">
            <div class="rd-cell"><div class="rd-val rd-date">${rec.date||'‚Äî'}</div><div class="rd-key">DATE</div></div>
            <div class="rd-cell"><div class="rd-val rd-err">${rec.errors!==''&&rec.errors!=null?rec.errors:'‚Äî'}</div><div class="rd-key">ERRORS</div></div>
            <div class="rd-cell"><div class="rd-val rd-tim">${rec.time||'‚Äî'}</div><div class="rd-key">TIME</div></div>
            <div class="rd-cell"><div class="rd-val rd-rem">${rec.remaining!==''&&rec.remaining!=null?rec.remaining:'‚Äî'}</div><div class="rd-key">REMAIN</div></div>
          </div>
        </div>` : `<div class="no-record">Êú™Ë®òÈå≤ ‚Äî SAVE„Åß‰øùÂ≠ò</div>`}
      `;
      row.appendChild(body);
    }

    list.appendChild(row);
  });

  document.getElementById('acc-done-lbl').textContent = `${done}/15`;
}

// ============================================================
// „Éò„ÉÉ„ÉÄ„ÉºÁµ±Ë®à
// ============================================================
function renderStats(){
  const cool = db.currentCool;
  let done=0, errs=0, ec=0, rems=0, rc=0;
  SECTIONS.forEach(sec=>{
    const r=getRec(cool,sec.id);
    if(r){
      done++;
      if(r.errors!==''&&r.errors!=null){errs+=Number(r.errors);ec++;}
      if(r.remaining!==''&&r.remaining!=null){rems+=Number(r.remaining);rc++;}
    }
  });
  document.getElementById('ts-done').textContent = done;
  document.getElementById('ts-avg').textContent  = ec>0?(errs/ec).toFixed(1):'‚Äî';
  document.getElementById('ts-rem').textContent  = rc>0?(rems/rc).toFixed(1):'‚Äî';
}

// ============================================================
// Ë™§Á≠î„ÉÅ„É£„Éº„Éà
// ============================================================
function renderChart(){
  const cool=db.currentCool;
  document.getElementById('ch-cool-lbl').textContent=`COOL ${cool}`;
  const area=document.getElementById('chart-area');
  area.innerHTML='';
  let maxE=1;
  const vals=SECTIONS.map(sec=>{
    const r=getRec(cool,sec.id);
    const err=(r&&r.errors!==''&&r.errors!=null)?Number(r.errors):null;
    if(err!=null&&err>maxE) maxE=err;
    return {sec,err};
  });
  vals.forEach(({sec,err})=>{
    const pct=err!=null?Math.round(err/maxE*100):0;
    const row=document.createElement('div');
    row.className='chart-row';
    row.innerHTML=`
      <span class="csl">S${sec.id}</span>
      <div class="cbw" onclick="toggleSec(${sec.id})" title="„ÇØ„É™„ÉÉ„ÇØ„ÅßÁ∑®ÈõÜ">
        <div class="cb" style="width:${pct}%"></div>
      </div>
      <span class="cv">${err!=null?err:'‚Äî'}</span>`;
    area.appendChild(row);
  });
}

// ============================================================
// ÂÖ®ÊèèÁîª
// ============================================================
function renderAll(){
  renderNav();
  renderStats();
  renderAcc();
  if(currentPage==='analysis') renderMatrix();
  if(currentPage==='settings') renderSettings();
}

renderAll();
</script>
</body>
</html>
